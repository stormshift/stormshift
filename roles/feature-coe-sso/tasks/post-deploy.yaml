---
- name: Include cluster_type specific tasks
  ansible.builtin.include_tasks: "post-deploy-{{ cluster_type }}.yaml"

- name: Add group local-cluster-admins
  kubernetes.core.k8s:
    kubeconfig: "{{ temp.path }}/kubeconfig"

    definition:
      apiVersion: user.openshift.io/v1
      kind: Group
      metadata:
        name: local-cluster-admins
      users:
        - "{{ tower_user_email }}-admin"

- name: Add cluster role
  kubernetes.core.k8s:
    kubeconfig: "{{ temp.path }}/kubeconfig"

    definition:
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRoleBinding
      metadata:
        name: coe-cluster-admins
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: ClusterRole
        name: cluster-admin
      subjects:
        - apiGroup: rbac.authorization.k8s.io
          kind: Group
          name: local-cluster-admins
        - apiGroup: rbac.authorization.k8s.io
          kind: Group
          name: global-cluster-admins
